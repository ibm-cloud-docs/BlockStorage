---

copyright:
  years: 2015, 2018
lastupdated: "2018-04-25"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# 使用复制

复制使用其中一个快照安排自动将快照复制到远程数据中心内的目标卷。万一发生数据损坏或灾难性事件，可以在远程站点中恢复副本。

通过复制，能够实现

- 通过故障转移到目标卷，快速从站点故障和其他灾难进行恢复。
- 故障转移到 DR 副本中的特定时间点。

必须创建快照安排后，才能进行复制。进行故障转移时，将“翻转开关”从主数据中心的存储卷切换到远程数据中心的目标卷。例如，主数据中心是伦敦，辅助数据中心是阿姆斯特丹。万一发生故障事件，将故障转移到阿姆斯特丹 - 从阿姆斯特丹的计算实例连接到现在的主卷。修复伦敦的卷之后，会生成阿姆斯特丹卷的快照，以便回退到伦敦，并从伦敦的计算实例连接到原先的主卷。


**注**：除非另有说明，否则对 {{site.data.keyword.blockstoragefull}} 和 File Storage 执行的步骤相同。

## 如何确定复制的存储卷的远程数据中心？

{{site.data.keyword.BluSoftlayer_full}} 在世界各地的数据中心已成对编成主卷和远程中心组合。
请参阅表 1，以获取数据中心可用性和复制目标的完整列表。
请注意，某些城市（例如，达拉斯、圣何塞、华盛顿特区和阿姆斯特丹）有多个数据中心。


<table cellpadding="1" cellspacing="1">
	<caption>表 1</caption>
	<tbody>
		<tr>
			<td><strong>美国 1</strong><sup><img src="/images/numberone.png" alt="1" /></sup></td>
			<td><strong>美国 2</strong></td>
			<td><strong>拉丁美洲/南美洲</strong></td>
			<td><strong>加拿大</strong></td>
			<td><strong>欧洲</strong></td>
			<td><strong>亚太地区</strong></td>
			<td><strong>澳大利亚</strong></td>
		</tr>
		<tr>
			<td>DAL01<br />
				DAL05<br />
				DAL06<br />
				HOU02<br />
				SJC01<br />
				WDC01<br />
				<br />
				<br />
				<br /><br />
			</td>
			<td>SJC03<br />
				SJC04<br />
				WDC04<br />
				WDC06<br />
				WDC07<br />
				DAL09<br />
				DAL10<br />
				DAL12<br />
				DAL13<br /><br />
			</td>
			<td>MEX01<br />
				SAO01<br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>TOR01<br />
				MON01<br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>
				AMS01<br />
				AMS03<br />
				FRA02<br />
				FRA04<br />
				LON02<br />
				LON04<br />
				LON06<br />
				OSL01<br />
				PAR01<br />
				MIL01<br />
			</td>
			<td>HKG02<br />
				TOK02<br />
				SNG01<br />
				SEO01<br />
                                CHE01<br />
				<br />
				<br />
				<br />
				<br />
				<br />
			</td>
			<td>
				SYD01<br />
				SYD04<br />
				MEL01<br />
				<br /><br /><br /><br /><br /><br /><br />
			</td>
		</tr>
		<tr>
			<td colspan="100%"><p><sup><img src="/images/numberone.png" alt="1" /></sup> 此区域的数据中心没有加密存储器。<br /><strong>注</strong>：具有加密存储器的数据中心<strong>无法</strong>将非加密数据中心的复制作为复制目标启动。</p>
			</td>
		</tr>
	</tbody>
</table>


## 如何创建初始复制？

复制将通过快照安排来执行。必须首先为源卷设置快照空间和快照安排，然后才能进行复制。如果尝试设置复制，但却出现这样或那样的问题，那么您会收到提示，通知您需要购买空间或设置安排。复制在 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的“存储”> {{site.data.keyword.blockstorageshort}} 或 File Storage 下进行管理。

1. 单击存储卷。
2. 单击**副本**选项卡，然后单击**购买复制**链接。
选择希望复制遵循的现有快照安排。此列表将包含所有有效的快照安排。<br />
  **注**：只能选择一个安排，即便有每小时、每天和每周的混合安排也是如此。不管启动哪个安排，都会复制自上一个复制周期以来捕获到的所有快照。<br />
  **注**：如果没有设置“快照”，系统将提示您进行设置，然后才能订购复制。有关更多详细信息，请参阅[使用快照](snapshots.html)。
3. 单击**位置**下拉箭头，然后选择将作为 DR 站点的数据中心。
4. 单击**继续**。
5. 如果您有促销代码，请在**促销代码**中进行输入，然后单击**重新计算**。对话框中的其他字段将为缺省值。
6. 单击**我已阅读主服务协议...** 复选框，然后单击**下单**。


## 如何编辑现有复制？

您可以在 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的**存储** > **{{site.data.keyword.blockstorageshort}}** 下的**主**或**副本**选项卡中，编辑复制安排和更改复制空间。



## 如何编辑复制安排？

编辑复制安排实际上是在更改快照安排，因为复制安排基于现有快照安排。要更改复制安排（例如，从每小时更改为每周），必须取消该复制安排，然后设置新的复制安排。

更改安排可以在“主”或“副本”选项卡上执行。

1. 单击**主**或**副本**选项卡中的**操作**下拉菜单。
2. 选择**编辑快照安排**。
3. 查看“安排”下的“快照”框架，以确定要用于复制的安排。对用于复制的安排进行更改；例如，如果复制安排为**每天**，那么可以更改执行复制的时刻。
4. 单击**保存**。


## 如何更改复制空间？

主快照空间和副本空间必须相同。如果在**主**或**副本**选项卡上更改空间，那么会自动将该空间添加到源和目标数据中心。请注意，增大快照空间将触发立即复制更新。

单击**主**或**副本**选项卡中的**操作**下拉菜单。选择**添加更多快照空间**。
从列表中选择存储器大小，然后单击**继续**。
如果您有促销代码，请在**促销代码**中进行输入，然后单击**重新计算**。对话框中的其他字段将为缺省值。单击“我已阅读主服务协议...”复选框，然后单击“下单”按钮。


## 如何在卷列表中查看我的副本卷？

您可以在**存储 > {{site.data.keyword.blockstorageshort}}** 下的 {{site.data.keyword.blockstorageshort}} 页面中查看复制卷。该 LUN 名称为主卷名称后跟 REP。“类型”为“耐久性（性能）- 副本”，“目标地址”为“不适用”（因为副本卷未安装在副本数据中心上），“状态”为“不活动”。



## 如何在副本数据中心查看复制卷的详细信息？

您可以在**存储 > {{site.data.keyword.blockstorageshort}}** 下的**副本**选项卡中查看副本卷详细信息。另一个选择是在 **{{site.data.keyword.blockstorageshort}}** 页面中选择副本卷，然后单击**副本**选项卡。



## 如何在故障转移到辅助数据中心之前指定主机授权？

已授权的主机和卷必须位于同一数据中心内。您不能使副本卷位于伦敦，而使主机位于阿姆斯特丹；副本卷和主机必须都位于伦敦，或者都位于阿姆斯特丹。

1. 在 **{{site.data.keyword.blockstorageshort}}** 页面中，单击源卷或目标卷。
2. 单击**副本**选项卡。
3. 向下滚动到**授权主机**框架，然后单击屏幕右侧的**授权主机**链接。
4. 突出显示要授权执行复制的主机。要选择多个主机，请使用 CTRL 键并单击适用的主机。
5. 单击**提交**。如果您没有主机，那么对话框将提供购买同一数据中心内计算资源的选项，或者您可以单击**关闭**。


## 如何在增大主数据中心内的空间时，增大副本数据中心内的快照空间？

主存储卷和副本存储卷的卷大小必须相同；不能其中一个卷大于另一个卷。增大主卷的快照空间时，副本空间也会自动增加。请注意，增大快照空间将触发立即复制更新。这两个卷的增大将在发票上显示为行项，并且将根据需要分派。

单击[此处](snapshots.html)以了解如何增大快照空间。



## 如何启动从卷故障转移到其副本？

发生故障事件时，**故障转移**操作支持您启动故障转移到目标卷。目标卷会变为活动状态，最后一个成功复制的快照会激活，并会使该卷变为活动状态以供安装。系统将销毁自上一个复制周期以来写入源卷的所有数据。请注意，一旦启动故障转移后，**复制关系会翻转**。目标卷现在成为源卷，原先的源卷会变成目标卷，以 **LUN 名称**后跟 **REP** 来指示。

故障转移在 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的**存储** > **{{site.data.keyword.blockstorageshort}}** 下启动。

**在继续此过程之前，建议先断开卷的连接。否则最终会导致数据损坏和/或丢失。**

1. 单击活动 LUN（“源”）。
2. 单击**副本**选项卡，然后单击右上角的**操作**链接。
3. 选择“故障转移”。
   您将在页面顶部收到一条消息，声明正在进行故障转移。此外，**{{site.data.keyword.blockstorageshort}}** 上的相应卷旁边会显示一个图标，指示正在执行活动事务。将鼠标悬停在该图标上将生成一个用于指示事务的对话框。一旦事务完成后，该图标会消失。在故障转移过程中，与配置相关的操作为只读；无法编辑任何快照安排、更改快照空间等。该事件将记录在复制历史记录中。
   另外还会有一条消息通知您目标卷何时处于活动状态。原始源卷的 LUN 名称会后跟 REP，其状态将为“不活动”。
4. 单击右上角的**查看全部** (**{{site.data.keyword.blockstorageshort}}**) 存储器链接。
5. 单击活动的 LUN（原先的目标卷）。现在，此卷的状态为**活动**。
6. 安装存储卷并将其连接到主机。单击[此处](provisioning-block_storage.html)以获取指示信息。


## 如何启动从卷故障恢复到其副本？

一旦修复原始源卷后，通过**故障恢复**操作可启动到原始源卷的受控故障恢复。在受控故障恢复中，

- 执行操作的源卷变为脱机状态；
- 生成快照；
- 完成复制周期；
- 激活刚才生成的数据快照；
- 并使源卷变为活动状态以供安装。

请注意，一旦启动了故障恢复，**复制关系会再次翻转**。原来的源卷会复原为源卷，原来的目标卷将再次成为目标卷，以 **LUN 名称**后跟 **REP** 来指示。

故障恢复在 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的**存储** > **{{site.data.keyword.blockstorageshort}}** 下启动。

1. 单击活动的耐久性 LUN（“目标”）。
2. 单击**副本**选项卡，然后单击右上角的**操作**链接。
3. 选择**故障恢复**。
   您将在页面顶部收到一条消息，声明正在进行故障转移。此外，**{{site.data.keyword.blockstorageshort}}** 上的相应卷旁边会显示一个图标，指示正在执行活动事务。将鼠标悬停在该图标上将生成一个用于指示事务的对话框。一旦事务完成后，该图标会消失。在故障恢复过程中，与配置相关的操作为只读；无法编辑任何快照安排、更改快照空间等。该事件将记录在复制历史记录中。
   另外还会有一条消息通知您源卷何时处于活动状态。现在，目标卷的状态为“不活动”。
4. 单击右上角的**查看全部** (**{{site.data.keyword.blockstorageshort}}**) 链接。
5. 单击活动的耐久性 LUN（源）。现在，此卷的状态为**活动**。
6. 安装存储卷并将其连接到主机。单击[此处](provisioning-block_storage.html)以获取指示信息。


## 如何查看复制历史记录？

复制历史记录可通过**管理**下**帐户**选项卡在**审计日志**上进行查看。主卷和副本卷将显示完全相同的复制历史记录，包括：

- 复制的类型（故障转移或故障恢复）
- 启动时间
- 用于复制的快照
- 复制的大小
- 完成时间


## 如何取消现有复制？

取消操作可以立即执行，也可以在周年日期执行；取消操作将导致记帐终止。可以在**主**或**副本**选项卡中取消复制。

1. 在 **{{site.data.keyword.blockstorageshort}}** 页面中，单击卷。
2. 单击**主**或**副本**选项卡上的**操作**下拉列表。
3. 选择**取消复制**。
4. 选择取消时间 - **立即**或**周年日期**，然后单击**继续**。
5. 单击**我确认取消操作可能会导致数据丢失**复选框，然后单击**取消复制**。


## 取消了主卷后，如何取消复制？

取消主卷后，将删除副本数据中心内的复制安排和卷。副本将在 {{site.data.keyword.blockstorageshort}} 页面中取消。

 1. 在 **{{site.data.keyword.blockstorageshort}}** 页面上，突出显示卷。
 2. 单击**操作**下拉菜单，然后选择**取消 {{site.data.keyword.blockstorageshort}}**。
 3. 选择取消卷的时间 - **立即**或**周年日期**，然后单击**继续**。
 4. 单击**我确认取消操作可能会导致数据丢失**复选框，然后单击**取消**。
